# Istio Mesh Configuration for Authorino ext_authz
# 
# This is a PATCH file. Apply with:
#   oc patch istio default -n istio-system --type=merge --patch-file manifests/istio/ext-authz-config.yaml
#
# This configures:
# 1. Request body forwarding to Authorino (required for OPA to inspect tool arguments)
# 2. REGISTRY_ONLY mode to block all outbound traffic by default
---
spec:
  values:
    meshConfig:
      outboundTrafficPolicy:
        mode: REGISTRY_ONLY
      extensionProviders:
        - name: kuadrant-authorization
          envoyExtAuthzGrpc:
            service: authorino-authorino-authorization.kuadrant-system.svc.cluster.local
            port: 50051
            timeout: 5s
            includeRequestBodyInCheck:
              maxRequestBytes: 8192
              allowPartialMessage: true
